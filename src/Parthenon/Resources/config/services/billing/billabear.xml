<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <defaults autoconfigure="true" />

        <service id="Parthenon\Billing\BillaBear\SdkFactory" class="Parthenon\Billing\BillaBear\SdkFactory">
            <argument>%parthenon_billing_billabear_api_url%</argument>
            <argument>%parthenon_billing_billabear_api_key%</argument>
        </service>

        <service id="Parthenon\Billing\Subscriber\CustomerCreatedSubscriber" class="Parthenon\Billing\Subscriber\CustomerCreatedSubscriber">
            <argument type="service" id="Parthenon\User\Repository\UserRepositoryInterface" />
            <argument type="service" id="Parthenon\Billing\BillaBear\SdkFactory" />
        </service>

        <service id="Parthenon\Billing\BillaBear\Repository\PaymentCardRepository" class="Parthenon\Billing\BillaBear\Repository\PaymentCardRepository">
            <argument type="service" id="Parthenon\Billing\BillaBear\SdkFactory" />
        </service>
        <service id="Parthenon\Billing\Repository\PaymentCardRepositoryInterface" alias="Parthenon\Billing\BillaBear\Repository\PaymentCardRepository" />

        <service id="Parthenon\Billing\BillaBear\PaymentMethod\Deleter" class="Parthenon\Billing\BillaBear\PaymentMethod\Deleter">
            <argument type="service" id="Parthenon\Billing\BillaBear\SdkFactory" />
        </service>
        <service id="Parthenon\Billing\PaymentMethod\DeleterInterface" alias="Parthenon\Billing\BillaBear\PaymentMethod\Deleter" />

        <service id="Parthenon\Billing\BillaBear\PaymentMethod\FrontendAddProcessor" class="Parthenon\Billing\BillaBear\PaymentMethod\FrontendAddProcessor">
            <argument type="service" id="Parthenon\Billing\BillaBear\SdkFactory" />
        </service>
        <service id="Parthenon\Billing\PaymentMethod\FrontendAddProcessorInterface" alias="Parthenon\Billing\BillaBear\PaymentMethod\FrontendAddProcessor" />

        <service id="Parthenon\Billing\BillaBear\Plan\BillaBearPlanManager" class="Parthenon\Billing\BillaBear\Plan\BillaBearPlanManager">
            <argument type="service" id="Parthenon\Billing\BillaBear\SdkFactory" />
        </service>

        <service id="Parthenon\Billing\Plan\CachedPlanManager" class="Parthenon\Billing\Plan\CachedPlanManager">
            <argument type="service" id="Parthenon\Billing\BillaBear\Plan\BillaBearPlanManager" />
            <argument type="service" id="Redis" />
            <call method="setLogger">
                <argument type="service" id="logger" />
            </call>
        </service>
        <service id="Parthenon\Billing\Plan\PlanManagerInterface" alias="Parthenon\Billing\Plan\CachedPlanManager" />

        <service id="Parthenon\Billing\BillaBear\SubscriptionManager" class="Parthenon\Billing\BillaBear\SubscriptionManager">
            <argument type="service" id="Parthenon\Billing\BillaBear\SdkFactory" />
            <argument type="service" id="Parthenon\Billing\Plan\PlanManagerInterface" />
            <argument type="service" id="Symfony\Component\EventDispatcher\EventDispatcherInterface" />
        </service>
        <service id="Parthenon\Billing\Subscription\SubscriptionManagerInterface" alias="Parthenon\Billing\BillaBear\SubscriptionManager" />

        <service id="Parthenon\Billing\BillaBear\Subscription\SubscriptionProvider" class="Parthenon\Billing\BillaBear\Subscription\SubscriptionProvider">
            <argument type="service" id="Parthenon\Billing\BillaBear\SdkFactory" />
        </service>
        <service id="Parthenon\Billing\Subscription\SubscriptionProviderInterface" alias="Parthenon\Billing\BillaBear\Subscription\SubscriptionProvider" />
    </services>
</container>
